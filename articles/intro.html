<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Get Started with dsl • dsl</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get Started with dsl">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dsl</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/intro.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/model.html">Models available in DSL</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/faq.html">Frequently Asked Questions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../articles/aggregate.html">Units of Analysis and Labeling Differ</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Get Started with dsl</h1>
            
      

      <div class="d-none name"><code>intro.Rmd</code></div>
    </div>

    
    
<p><br></p>
<p class="h5">
<strong>On this page, we provide the introduction to <code>dsl</code>
package.</strong>
</p>
<br><div class="card bg-light mb-3">
<div class="card-header">
<strong>Table of Contents</strong>
</div>
<div class="card-body">
<ul>
<li><p><a href="#over"><strong>Overview</strong></a> <br> We provide the
overview of <code>dsl</code> package.</p></li>
<li><p><a href="#dsl"><strong><code>dsl</code>: DSL
Estimator</strong></a> <br> We explain how to use function
<code><a href="../reference/dsl.html">dsl()</a></code> to use predicted variables in statistical
analyses.</p></li>
</ul>
</div>
</div>
<p><br></p>
<p>DSL is a general estimation framework for using predicted variables
in statistical analyses. The package is especially useful for
researchers trying to use large language models (LLMs) to annotate a
large number of documents they analyze subsequently. DSL allows users to
obtain statistically valid estimates and standard errors, even when LLM
annotations contain arbitrary non-random prediction errors and
biases.</p>
<div class="section level3">
<h3 id="over">
<strong>Overview</strong><a class="anchor" aria-label="anchor" href="#over"></a>
</h3>
<p class="lh-lg">
</p>
<p>In text-as-data applications, one of the most common tasks is text
annotation (or text classification) to generate text-based variables for
subsequent statistical analyses. For example, researchers might first
annotate whether each online post contains hate speech such that they
can later study who are more likely to post hate speech and what types
of interventions can reduce hate speech. Over the last decade, scholars
used a variety of supervised machine learning (ML) methods to automate
this text annotation step by training machines to mimic expert-coding.
More recently, a growing number of papers propose using large language
models (LLMs), such as ChatGPT, to automate text annotations by
predicting expert annotations. Given that researchers can adapt LLMs to
perform a wide range of text annotation tasks by simply changing
prompts, automated LLM annotations present exciting opportunities for
the social sciences.</p>
<p>While text annotation is essential, it is only the first step. Social
scientists are often primarily interested in using text labels predicted
by automated methods as key variables in subsequent statistical
analyses. In the vast majority of current applications, researchers
treat predicted text-based variables as if they were observed without
any error: they ignore <strong>prediction errors</strong> in the first
step of automated text annotation. However, ignoring such prediction
errors in the first step of text annotation, even if errors are small,
leads to substantial bias, invalid confidence intervals, and wrong
p-values in downstream statistical analyses of text-based variables.
Biases from prediction errors exist even when the prediction accuracy in
the text classification step is extremely high, e.g., above 90% or even
at 95%. This is because prediction errors are not random—prediction
errors are correlated with observed and unobserved variables we include
in downstream analyses. In practice, this means that substantive and
statistical conclusions can easily flip if researchers ignore prediction
errors in automated text annotation methods.</p>
<p><strong>Design-based supervised learning (DSL)</strong> is a general
framework for using predicted variables in downstream statistical
analyses without suffering from bias due to prediction errors. Unlike
the existing approaches, DSL allows researchers to obtain statistically
valid estimates and standard errors, even when automated text annotation
methods have arbitrary non-random prediction errors. To do so, DSL
combines large-scale (potentially biased) automated annotations and a
smaller number of high-quality expensive expert annotations using a
doubly robust bias-correction step. Please read <a href="https://naokiegami.com/paper/dsl.pdf" class="external-link">Egami, Hinck, Stewart, and
Wei (2023)</a> for the methodological details.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="dsl">
<strong><code>dsl</code>: DSL Estimator</strong><a class="anchor" aria-label="anchor" href="#dsl"></a>
</h3>
<p class="lh-lg">
</p>
<p>As an example, we use Pan and Chen (2018), which studies whether
online complaints accusing of corruption by local officials are reported
to upper-level governments in China. In this example, variable
<code>countyWrong</code> (whether a post accuses of corruption by
county-level politicians) requires text annotation. We randomly sampled
a subset of the data (500 documents) to provide expert annotations for
this variable.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://naokiegami.com/dsl/">dsl</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"PanChen"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">PanChen</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   countyWrong pred_countyWrong SendOrNot prefecWrong connect2b prevalence</span></span>
<span><span class="co">## 1           0                0         0           0         1          0</span></span>
<span><span class="co">## 2           0                1         0           0         0          0</span></span>
<span><span class="co">## 3           1                0         0           0         0          0</span></span>
<span><span class="co">## 4          NA                0         0           0         1          0</span></span>
<span><span class="co">## 5          NA                0         0           1         0          0</span></span>
<span><span class="co">## 6          NA                0         0           0         1          0</span></span>
<span><span class="co">##   regionj groupIssue</span></span>
<span><span class="co">## 1       0          1</span></span>
<span><span class="co">## 2       0          1</span></span>
<span><span class="co">## 3       0          1</span></span>
<span><span class="co">## 4       0          1</span></span>
<span><span class="co">## 5       0          1</span></span>
<span><span class="co">## 6       0          1</span></span></code></pre>
<p>Variable <code>countyWrong</code> represents expert labels, and it
takes <code>NA</code> if a given observation is not labeled by
experts.</p>
<p>Variable <code>pred_countyWrong</code> represents text labels
predicted by a user-specified automated text annotation method, e.g.,
annotations given by a user-specified LLM. In this example, variable
<code>pred_countyWrong</code> represent annotations given by GPT-4.
Unlike variable <code>countyWrong</code>, variable
<code>pred_countyWrong</code> is available for the entire data.</p>
<p>The remaining six columns represent other key variables included in
the main statistical analyses.</p>
<p>If users include <code>pred_countyWrong</code> instead of
<code>countyWrong</code> in the downstream analyses, they will suffer
from biases due to prediction errors. If users worry about prediction
errors and only use a subset of the data that have expert-coded
<code>countyWrong</code>, they have to miss a large number of
observations.</p>
<p>Researchers can use <code>dsl</code> to perform their main
statistical analyses by analyzing all the data while taking into account
prediction errors. In this example, we are interested in running a
logistic regression model regressing binary outcome
<code>SendOrNot</code> on a set of independent variables, including
<code>countyWrong</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dsl.html">dsl</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"logit"</span>, </span>
<span>           formula <span class="op">=</span> <span class="va">SendOrNot</span> <span class="op">~</span> <span class="va">countyWrong</span> <span class="op">+</span> <span class="va">prefecWrong</span> <span class="op">+</span> </span>
<span>             <span class="va">connect2b</span> <span class="op">+</span> <span class="va">prevalence</span> <span class="op">+</span> <span class="va">regionj</span> <span class="op">+</span> <span class="va">groupIssue</span>,</span>
<span>           predicted_var <span class="op">=</span> <span class="st">"countyWrong"</span>,</span>
<span>           prediction <span class="op">=</span> <span class="st">"pred_countyWrong"</span>,</span>
<span>           data <span class="op">=</span> <span class="va">PanChen</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Cross-Fitting: 1/10..2/10..3/10..4/10..5/10..6/10..7/10..8/10..9/10..10/10..</span></span></code></pre>
<table class="table">
<colgroup>
<col width="26%">
<col width="73%">
</colgroup>
<thead><tr class="header">
<th align="left">Argument</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>model</code></td>
<td align="left">A regression model. <code>dsl</code> currently supports
<code>lm</code> (linear regression), <code>logit</code> (logistic
regression), and <code>felm</code> (fixed-effects regression).</td>
</tr>
<tr class="even">
<td align="left"><code>formula</code></td>
<td align="left">A formula used in the specified regression model.</td>
</tr>
<tr class="odd">
<td align="left"><code>predicted_var</code></td>
<td align="left">A vector of column names in the data that correspond to
variables that need to be predicted.</td>
</tr>
<tr class="even">
<td align="left"><code>prediction</code></td>
<td align="left">A vector of column names in the data that correspond to
predictions of <code>predicted_var</code>.</td>
</tr>
<tr class="odd">
<td align="left"><code>data</code></td>
<td align="left">A data frame. The class should be
<code>data.frame</code>.</td>
</tr>
</tbody>
</table>
<p>Researchers can obtain the summary of output using function
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ==================</span></span>
<span><span class="co">## DSL Specification:</span></span>
<span><span class="co">## ==================</span></span>
<span><span class="co">## Model:  logit</span></span>
<span><span class="co">## Call:  SendOrNot ~ countyWrong + prefecWrong + connect2b + prevalence + regionj + groupIssue</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Predicted Variables:  countyWrong</span></span>
<span><span class="co">## Prediction:  pred_countyWrong</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of Labeled Observations:  500</span></span>
<span><span class="co">## Random Sampling for Labeling with Equal Probability: Yes</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## =============</span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## =============</span></span>
<span><span class="co">##             Estimate Std. Error CI Lower CI Upper p value    </span></span>
<span><span class="co">## (Intercept)   2.0978     0.3621   1.3881   2.8075  0.0000 ***</span></span>
<span><span class="co">## countyWrong  -0.2617     0.2230  -0.6988   0.1754  0.1203    </span></span>
<span><span class="co">## prefecWrong  -1.1162     0.2970  -1.6982  -0.5342  0.0001 ***</span></span>
<span><span class="co">## connect2b    -0.0788     0.1197  -0.3134   0.1558  0.2552    </span></span>
<span><span class="co">## prevalence   -0.3271     0.1520  -0.6250  -0.0292  0.0157   *</span></span>
<span><span class="co">## regionj       0.1253     0.4566  -0.7695   1.0202  0.3919    </span></span>
<span><span class="co">## groupIssue   -2.3222     0.3597  -3.0271  -1.6172  0.0000 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## 95% confidence intervals (CI) are reported.</span></span></code></pre>
<p>It first outputs the specification of the DSL estimation, including
the number of labeled observations and the sampling process for expert
annotations. When users do not specify explicitly, function
<code><a href="../reference/dsl.html">dsl()</a></code> assumes random sampling with equal probabilities. If
users deployed a sampling strategy other than random sampling with equal
probabilities, they have to explicitly specify it using argument
<code>sample_prob</code> when fitting <code>dsl</code> (please see <a href="http://naokiegami.com/dsl/articles/faq.html">this page</a>).</p>
<p>As for coefficients, researchers can interpret estimates and standard
errors as in the usual regression analyses. The package implements the
hetroskedasticity-robust standard errors by default. When users want to
compute cluster-robust standard errors, they can use argument
<code>cluster</code>, which we explain more <a href="http://naokiegami.com/dsl/articles/faq.html">here</a>.</p>
<p>The package supports different types of regression models: linear
regression (<code>lm</code>), logistic regression (<code>logit</code>),
and linear fixed-effects regression (<code>felm</code>). To learn more
about each model, please visit <strong><a href="http://naokiegami.com/dsl/articles/model.html">Models Available in
DSL</a></strong>.</p>
<p>To help users apply DSL in various practical settings, we answer
frequently asked questions at <strong><a href="http://naokiegami.com/dsl/articles/faq.html">Frequently Asked
Questions</a></strong>, including how to determine the required number
of expert annotations, how to incorporate more complex sampling
strategies for expert annotations, and how to handle cluster standard
errors.</p>
<p><strong>References:</strong></p>
<ul>
<li><p><a href="https://naokiegami.com/paper/dsl_ss.pdf" class="external-link">Egami, Hinck,
Stewart, and Wei. (2024)</a>. “Using Large Language Model Annotations
for the Social Sciences: A General Framework of Using Predicted
Variables in Downstream Analyses.”</p></li>
<li><p><a href="https://naokiegami.com/paper/dsl.pdf" class="external-link">Egami, Hinck,
Stewart, and Wei. (2023)</a>. Using Imperfect Surrogates for Downstream
Inference: Design-based Supervised Learning for Social Science
Applications of Large Language Models, Advances in Neural Information
Processing Systems (NeurIPS).</p></li>
<li><p><a href="https://journals.sagepub.com/doi/abs/10.1177/00491241251333372" class="external-link">Rister
Portinari Maranca, Chung, Hinck, Wolsky, Egami, and Stewart. (2025)</a>.
“Correcting the Measurement Errors of AI-Assisted Labeling in Image
Analysis Using Design-Based Supervised Learning,” Sociological Methods
and Research.</p></li>
<li><p>Pan and Chen. (2018). Concealing Corruption: How Chinese
Officials Distort Upward Reporting of Online Grievances. American
Political Science Review 112, 3, 602–620.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Naoki Egami, Musashi Hinck, Brandon M. Stewart, Hanying Wei.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
